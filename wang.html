<!DOCTYPE html>
<html><head>
<meta charset="utf-8">

<title>Unicode tester</title>

<style>
@import url('https://fonts.googleapis.com/css?family=Verdana');
@import url('https://fonts.googleapis.com/css?family=PT+Mono');
</style>
<script src="scripts/rot.min.js"></script>
<script src="scripts/rotjsmods.js"></script>
<script src="wangtiles.js"></script>
</head>
<body>
</body>
<script>
let WIDTH = 256;
let HEIGHT = 256;
let SCALE = 2;
let TILE = 8;
let canv = document.createElement("canvas");
document.body.appendChild(canv);
let ctx = canv.getContext("2d");
canv.height = HEIGHT*SCALE;
canv.width = WIDTH*SCALE;

let grid = [];
for (let i=0; i<WIDTH/TILE; i++) {
	grid.push([]);
	for (let j=0; j<HEIGHT/TILE; j++) {
		grid[i][j] = [];
	}
}
let flooded = {};
let P2 = 0.55;
let P1 = 0.85;
function flood(i,j) {
	flooded[i+":"+j] = true;
	if (i>0 && flooded[(i-1)+":"+j]) {
		grid[i][j][0] = grid[i-1][j][2];
		grid[i][j][7] = grid[i-1][j][3];
		grid[i][j][6] = grid[i-1][j][4];
	}
	if (i<WIDTH/TILE-1 && flooded[(i+1)+":"+j]) {
		grid[i][j][2] = grid[i+1][j][0];
		grid[i][j][3] = grid[i+1][j][7];
		grid[i][j][4] = grid[i+1][j][6];
	}
	if (j>0 && flooded[i+":"+(j-1)]) {
		grid[i][j][2] = grid[i][j-1][4];
		grid[i][j][1] = grid[i][j-1][5];
		grid[i][j][0] = grid[i][j-1][6];
	}
	if (j<HEIGHT/TILE-1  && flooded[i+":"+(j+1)]) {
		grid[i][j][4] = grid[i][j+1][2];
		grid[i][j][5] = grid[i][j+1][1];
		grid[i][j][6] = grid[i][j+1][0];
	}
	for (let k=0; k<8; k++) {
		if (grid[i][j][k]===undefined) {
			let P = (k===1 || k===3 || k===5 || k===7) ? P1 : P2;
			grid[i][j][k] = (ROT.RNG.getUniform()<P) ? 1 : 0;
		}
	}
	if (i>0 && flooded[(i-1)+":"+j]!==true) {
		flood(i-1,j);
	}
	if (i<WIDTH/TILE-1 && flooded[(i+1)+":"+j]!==true) {
		flood(i+1,j);
	}
	if (j>0 && flooded[i+":"+(j-1)]!==true) {
		flood(i,j-1);
	}
	if (j<HEIGHT/TILE-1 && flooded[i+":"+(j+1)]!==true) {
		flood(i,j+1);
	}
}

flood(0,0);

for (let i=0; i<WIDTH/TILE; i++) {
	for (let j=0; j<HEIGHT/TILE; j++) {
		let key = "t"+grid[i][j].join("");
		let squares = wangtiles[key].squares;
		let r = ROT.RNG.getUniformInt(1,squares.length)-1;
		let square = squares[r];
		ctx.fillStyle= "black";
		for (let x=0; x<TILE; x++) {
			for (let y=0; y<TILE; y++) {
				if (square[x][y]===1) {
					ctx.fillRect((i*TILE+x)*SCALE,(j*TILE+y)*SCALE,SCALE,SCALE);
				}
			}
		}
		ctx.fillStyle = "red";
		//ctx.fillRect(i*TILE*SCALE,j*TILE*SCALE,TILE*SCALE,1);
		//ctx.fillRect(i*TILE*SCALE,j*TILE*SCALE,1,TILE*SCALE);
	}
}
</script>
</html>
