<!DOCTYPE html>
<html><head>
<meta charset="utf-8">

<title>Cellular Automata tester</title>

<style>
</style>
<script src="scripts/rot.js"></script>
<script src="scripts/rotjsmods.js"></script>
</head>
<body>
<canvas id="canv"></canvas>
<br>
<input id="r" type="number" min="0" max="1.0" step="0.05" value="0.5" height="20" width=50></input>
<button id="reset" height="20" width=50>Reset</button>
<button id="1pixel" height="20" width=50>1Pixel</button>
<button id="once" height="20" width=50>Once</button>
<button id="go" height="20" width=50>Go</button>
<input id="border" type="checkbox">Border?</input>
<br>
<p>Born:</p>
<input id="b0" type="checkbox">0</input>
<input id="b1" type="checkbox">1</input>
<input id="b2" type="checkbox">2</input>
<input id="b3" type="checkbox">3</input>
<input id="b4" type="checkbox" checked="true">4</input>
<input id="b5" type="checkbox" checked="true">5</input>
<input id="b6" type="checkbox" checked="true">6</input>
<input id="b7" type="checkbox" checked="true">7</input>
<input id="b8" type="checkbox" checked="true">8</input>
<p>Survive:</p>
<input id="s0" type="checkbox">0</input>
<input id="s1" type="checkbox">1</input>
<input id="s2" type="checkbox" checked="true">2</input>
<input id="s3" type="checkbox" checked="true">3</input>
<input id="s4" type="checkbox" checked="true">4</input>
<input id="s5" type="checkbox" checked="true">5</input>
<input id="s6" type="checkbox">6</input>
<input id="s7" type="checkbox">7</input>
<input id="s8" type="checkbox">8</input>
<p>Presets:</p>
Randomize: <button id="randomize" onclick="randomize(event);" height="20" width="50">B678/S345678</button>
<br>
Default: <button onclick="popular(event);" height="20" width=50>B678/S345678</button>
<br>
Game of Life: <button onclick="popular(event);" height="20" width=50>B3/S23</button>
<br>
Caves:
<button onclick="popular(event);" height="20" width=50>B678/S345678</button>
<br>
Smoothing:
<button onclick="popular(event);" height="20" width=50>B5678/S5678</button>

</body>
<script>
let canv = document.getElementById("canv");
let ctx = canv.getContext("2d");
let h = canv.height = 510;
let w = canv.width = 510;
let size = 10;
let map;
let running = false;

function once() {
	for (let i=0; i<=8; i++) {
		if (document.getElementById("b"+i).checked) {
			map._options.born.push(i);
		}
		if (document.getElementById("s"+i).checked) {
			map._options.survive.push(i);
		}
	}
	map.create();
	if (document.getElementById("border").checked) {
		for (let i=0; i<w/size; i++) {
			for (let j=0; j<h/size; j++) {
				if (i===0 || j===0 || i===w/size-1 || j===w/size-1) {
					map._map[i][j] = 1;
				}
			}
		}
	}
	draw();
}
function reset() {
	running = false;
	map = new ROT.Map.Cellular(w/size, h/size, {
	    born: [],
	    survive: []
	});
	for (let i=0; i<=8; i++) {
		if (document.getElementById("b"+i).checked) {
			map._options.born.push(i);
		}
		if (document.getElementById("s"+i).checked) {
			map._options.survive.push(i);
		}
	}
	map.randomize(document.getElementById("r").value);
	if (document.getElementById("border").checked) {
		for (let i=0; i<w/size; i++) {
			for (let j=0; j<h/size; j++) {
				if (i===0 || j===0 || i===w/size-1 || j===w/size-1) {
					map._map[i][j] = 1;
				}
			}
		}
	}
	draw();
}
function pixel() {
	running = false;
	map = new ROT.Map.Cellular(w/size, h/size, {
	    born: [],
	    survive: []
	});
	for (let i=0; i<=8; i++) {
		if (document.getElementById("b"+i).checked) {
			map._options.born.push(i);
		}
		if (document.getElementById("s"+i).checked) {
			map._options.survive.push(i);
		}
	}
	for (let i=0; i<w/size; i++) {
		for (let j=0; j<h/size; j++) {
			if (document.getElementById("border").checked && (i===0 || j===0 || i===w/size-1 || j===w/size-1)) {
				map._map[i][j] = 1;
			} else if (i===parseInt(0.5*w/size) && j===parseInt(0.5*h/size)) {
				map._map[i][j] = 1;
			} else {
				map._map[i][j] = 0;
			}
		}
	}
	draw();
}

function go() {
	if (running) {
		running = false;
		return;
	}
	running = true;
	function recurse() {
		if (running) {
			once();
			setTimeout(recurse, 250);
		}
	}
	recurse();
}

function draw() {
	for (let i=0; i<map._map.length; i++) {
		for (let j=0; j<map._map[i].length; j++) {
			let val = map._map[i][j];
			if (val) {
				ctx.fillStyle="black";
			} else {
				ctx.fillStyle="white";
			}
			ctx.fillRect(size*i+1,size*j+1,size-2,size-2);
		}
	}
}
function randomize(e) {
	running = false;
	let b = [];
	let s = [];
	for (let i=0; i<=8; i++) {
		if (Math.random()<0.5) {
			b.push(i);
		}
		if (Math.random()<0.5) {
			s.push(i);
		}
	}
	b = "B" + b.join("");
	s = "S" + s.join("");
	e.target.innerHTML = b+"/"+s;
	popular(e);
}
function popular(e) {
	running = false;
	let txt = e.target.innerHTML.split("/");
	let b = txt[0].substr(1).split("");
	let s = txt[1].substr(1).split("");
	for (let i=0; i<=8; i++) {
		let c = String(i);
		if (b.indexOf(c)!==-1) {
			document.getElementById("b"+i).checked = true;
		} else {
			document.getElementById("b"+i).checked = false;
		}
		if (s.indexOf(c)!==-1) {
			document.getElementById("s"+i).checked = true;
		} else {
			document.getElementById("s"+i).checked = false;
		}
	}
	document.getElementById("randomize").innerHTML = e.target.innerHTML;
}

canv.addEventListener("click", function(e) {
	running = false;
	e.preventDefault();
	let rect = this.getBoundingClientRect();
    x = parseInt((e.clientX-rect.left)/size);
    y = parseInt((e.clientY-rect.top)/size);

    let img = ctx.getImageData(x*size+1,y*size+1,1,1).data;
    if (img[0]) {
    	map._map[x][y] = 1;
    } else {
    	map._map[x][y] = 0;
    }
    draw();
});

let button;
button = document.getElementById("reset");
button.onclick = function() {reset();};
button = document.getElementById("1pixel");
button.onclick = function() {pixel();};
button = document.getElementById("once");
button.onclick = function() {once();};
button = document.getElementById("go");
button.onclick = function() {go();};



reset();
</script>
</html>
